#!/usr/bin/make -f

export DH_VERBOSE = 1

DEB_BUILD_GNU_TYPE = $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
DEB_HOST_GNU_TYPE = $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
ifneq ($(DEB_BUILD_GNU_TYPE),$(DEB_HOST_GNU_TYPE))
CONFARGS = --host=$(DEB_HOST_GNU_TYPE)
endif

LIB_DIR	 = usr/lib/$(DEB_HOST_MULTIARCH)

TARGET_PREFIX=/usr/lib/sandboxer
PACKAGE=sandboxer
TARGET_INSTALL_PREFIX=debian/$(PACKAGE)$(TARGET_PREFIX)

%:
	dh $@

dhar-stamp:
	dh_autoreconf
	(cd doc && po4a -k 0 --rm-backups --variable "srcdir=../doc/" po4a/po4a.cfg) || exit 1
	touch $@

obj-tcp/config.status: dhar-stamp
	dh_testdir
	mkdir obj-tcp
	cd obj-tcp && CFLAGS="$(CFLAGS)" ../configure --prefix="/fixups/fakeroot-host" --bindir="/fixups/fakeroot-host" --libdir="/fixups/fakeroot-host" --mandir="/fixups/fakeroot-host/man" --with-ipc=tcp $(CONFARGS)

override_dh_auto_configure: obj-tcp/config.status

override_dh_auto_build:
	cd obj-tcp && $(MAKE)

override_dh_auto_install:
	cd obj-tcp && $(MAKE) DESTDIR="$(CURDIR)/$(TARGET_INSTALL_PREFIX)/bin" install

override_dh_auto_clean:
	rm -rf obj-tcp
	dh_autoreconf_clean
	rm -f dhar-stamp
